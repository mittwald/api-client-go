package licenseclientv2

// This code was automatically generated by github.com/mittwald/api-client-go-builder.
// DO NOT EDIT.

import (
	"context"
	"encoding/json"
	"net/http"

	"github.com/mittwald/api-client-go/mittwaldv2/generated/schemas/licensev2"
	"github.com/mittwald/api-client-go/pkg/httpclient"
	"github.com/mittwald/api-client-go/pkg/httperr"
)

type Client interface {
	GetLicense(
		ctx context.Context,
		req GetLicenseRequest,
		reqEditors ...func(req *http.Request) error,
	) (*licensev2.License, *http.Response, error)
	ListLicensesForProject(
		ctx context.Context,
		req ListLicensesForProjectRequest,
		reqEditors ...func(req *http.Request) error,
	) (*[]licensev2.License, *http.Response, error)
	RotateLicenseKey(
		ctx context.Context,
		req RotateLicenseKeyRequest,
		reqEditors ...func(req *http.Request) error,
	) (*licensev2.KeyResponse, *http.Response, error)
	ValidateLicenseKeyForProject(
		ctx context.Context,
		req ValidateLicenseKeyForProjectRequest,
		reqEditors ...func(req *http.Request) error,
	) (*ValidateLicenseKeyForProjectResponse, *http.Response, error)
}
type clientImpl struct {
	client httpclient.RequestRunner
}

func NewClient(client httpclient.RequestRunner) Client {
	return &clientImpl{client: client}
}

// Get a license.
func (c *clientImpl) GetLicense(
	ctx context.Context,
	req GetLicenseRequest,
	reqEditors ...func(req *http.Request) error,
) (*licensev2.License, *http.Response, error) {
	httpReq, err := req.BuildRequest(reqEditors...)
	if err != nil {
		return nil, nil, err
	}

	httpRes, err := c.client.Do(httpReq.WithContext(ctx))
	if err != nil {
		return nil, httpRes, err
	}

	if httpRes.StatusCode >= 400 {
		err := httperr.ErrFromResponse(httpRes)
		return nil, httpRes, err
	}

	var response licensev2.License
	if err := json.NewDecoder(httpRes.Body).Decode(&response); err != nil {
		return nil, httpRes, err
	}
	return &response, httpRes, nil
}

// List Licenses belonging to a Project.
func (c *clientImpl) ListLicensesForProject(
	ctx context.Context,
	req ListLicensesForProjectRequest,
	reqEditors ...func(req *http.Request) error,
) (*[]licensev2.License, *http.Response, error) {
	httpReq, err := req.BuildRequest(reqEditors...)
	if err != nil {
		return nil, nil, err
	}

	httpRes, err := c.client.Do(httpReq.WithContext(ctx))
	if err != nil {
		return nil, httpRes, err
	}

	if httpRes.StatusCode >= 400 {
		err := httperr.ErrFromResponse(httpRes)
		return nil, httpRes, err
	}

	var response []licensev2.License
	if err := json.NewDecoder(httpRes.Body).Decode(&response); err != nil {
		return nil, httpRes, err
	}
	return &response, httpRes, nil
}

// rotate a License's key, i.e. revoke the old and generate a new one.
func (c *clientImpl) RotateLicenseKey(
	ctx context.Context,
	req RotateLicenseKeyRequest,
	reqEditors ...func(req *http.Request) error,
) (*licensev2.KeyResponse, *http.Response, error) {
	httpReq, err := req.BuildRequest(reqEditors...)
	if err != nil {
		return nil, nil, err
	}

	httpRes, err := c.client.Do(httpReq.WithContext(ctx))
	if err != nil {
		return nil, httpRes, err
	}

	if httpRes.StatusCode >= 400 {
		err := httperr.ErrFromResponse(httpRes)
		return nil, httpRes, err
	}

	var response licensev2.KeyResponse
	if err := json.NewDecoder(httpRes.Body).Decode(&response); err != nil {
		return nil, httpRes, err
	}
	return &response, httpRes, nil
}

// Validate a License's key for a project.
func (c *clientImpl) ValidateLicenseKeyForProject(
	ctx context.Context,
	req ValidateLicenseKeyForProjectRequest,
	reqEditors ...func(req *http.Request) error,
) (*ValidateLicenseKeyForProjectResponse, *http.Response, error) {
	httpReq, err := req.BuildRequest(reqEditors...)
	if err != nil {
		return nil, nil, err
	}

	httpRes, err := c.client.Do(httpReq.WithContext(ctx))
	if err != nil {
		return nil, httpRes, err
	}

	if httpRes.StatusCode >= 400 {
		err := httperr.ErrFromResponse(httpRes)
		return nil, httpRes, err
	}

	var response ValidateLicenseKeyForProjectResponse
	if err := json.NewDecoder(httpRes.Body).Decode(&response); err != nil {
		return nil, httpRes, err
	}
	return &response, httpRes, nil
}
